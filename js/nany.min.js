/*!
 * Nainy Application & Library
 * https://github.com/sprat/nany
 *
 * Copyright 2015 by Sylvain Prat
 * Released under the MIT licence.
 */
!function(){var n,e,t,r,i,o,a,u,c,s,l,f,d,m,p,v,g,b,h,y,w,j,E;n=function(){function n(){var n=Math.round(1e3*Math.random());return"guest"+n}function e(e,t){return Object.freeze({name:e||n(),image:t})}return e}(),e=function(){function n(n){return r+"/jeu/"+(n||"index")+".php"}function e(n){return r+"/images/"+n}function t(e){var t=e.location,r=t.origin+t.pathname;return r===n()}var r="http://www.nainwak.com";return{gameUrl:n,imageUrl:e,isInGame:t}}(),t=function(n){function e(e){if(n.isInGame(e)){var t=e.frames.menu,r=t.document,i=r.querySelector(".news-titre"),o=i.querySelector("td:last-child").innerHTML,a=i.querySelector("td:first-child img").src;return{nom:o,image:a}}}return{get:e}}(e),r=function(){function n(n,e){if(!n)throw new Error(e||"Assertion failed")}return n}(),i=function(n){function e(n){var e=document.createElement("textarea");return e.innerHTML=n,e.value}function t(n){var t=n.replace(/([\[,]\s*)'(.*)'(\s*[,\]])/g,function(n,e,t,r){var i=t.replace(/"/g,'\\"');return e+'"'+i+'"'+r}),r=JSON.parse(t);return r.map(function(n){return e(n)})}function r(n,e){var t,r,i=n.length;for(t=0;i>t;t+=1)if(r=n[t],e(r))return r}function i(e,t){n(e.length===t.length,"should have the same length");var r={};return e.forEach(function(n,e){r[n]=t[e]}),r}return{parse:t,find:r,toObject:i}}(r),o=function(n){function e(e){function t(t){return n.find(e,function(n){return n.url===t})}function r(t){return n.find(e,function(n){return n.name===t})}return Object.freeze({list:e,byName:r,byUrl:t})}return e}(i),a=function(){function n(n,e){var t=e||window.document,r=t.createElement("a");return r.href=n,r}function e(e,t){return n(e,t).href}function t(n){var e=[];return Object.keys(n).forEach(function(t){var r=n[t],i=encodeURIComponent(t),o=encodeURIComponent(r);e.push(i+"="+o)}),e.join("&")}return{parse:n,normalize:e,buildQueryParams:t}}(),u=function(){function n(n){var e=Array.prototype.slice.call(arguments,1);return e.forEach(function(e){e&&Object.keys(e).forEach(function(t){n[t]=e[t]})}),n}return n}(),c=function(n){function e(n){var e=new DOMParser;return e.parseFromString(n,"text/html")}function t(n,e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="document",t.onreadystatechange=function(){4===t.readyState&&e({status:t.status,document:t.response})},t.send(null)}function r(e){function t(n){return e.createTextNode(n)}function r(r,i,o){var a=e.createElement(r);return i&&(Array.isArray(i)||(i=[i]),i.forEach(function(n){("string"==typeof n||n instanceof String)&&(n=t(n)),a.appendChild(n)})),n(a,o),a}var o={};return o.text=t,i.forEach(function(n){o[n]=r.bind(null,n)}),o}var i=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","data","datalist","dd","del","details","dfn","div","dl","dt","em","embed","eventsource","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","mark","map","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","ruby","rp","rt","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];return{parseDocument:e,load:t,renderer:r}}(u),s=function(n,e,t,r){function i(i,o,a){function u(n){var t={IDS:n};return a&&r(t,a),s+"?"+e.buildQueryParams(t)}function c(n,e){var r=u(n);t.load(r,function(n){var t=null;200===n.status&&(t=o(n.document)),e(t)})}var s=n.gameUrl(i);return Object.freeze({name:i,url:s,analyze:o,load:c})}return i}(e,a,c,u),l=function(n){function e(e,t){n(e&&e.exec&&e.test,"not a RegExp object");var r,i=[],o=function(){var n=e.exec(t);return null!==n?(i.push(n),!0):!1};if(e.global){do r=o();while(r)}else o();return i}return{getAllMatches:e}}(r),f=function(n,e,t,r){function i(n){return parseInt(n,10)}function o(n){var e=n.getElementsByClassName("c1")[0],t=e.textContent,r=/Position\s\((\d+),(\d+)\)\ssur\s"([^"]*)"/i,o=r.exec(t);return o?{position:[i(o[1]),i(o[2])],monde:o[3]}:void 0}function a(n){var e=Array.prototype.map.call(n.scripts,function(n){return n.src?"":n.innerHTML});return e.join("\n")}function u(n,e,i,o){var u=a(n),c=r.getAllMatches(e,u);return c.map(function(n){var e=t.parse(n[1]),r=t.toObject(i,e);return o(r)})}function c(n){var e=/<span\s+style=\"color:(#[0-9A-F]{6});\">([^<]*)<\/span>/i,t=e.exec(n);return t?{nom:t[2],couleur:t[1]}:void 0}function s(n){function t(n){switch(n){case 0:return"nain-d√©ci";case 1:return"brave";case 2:return"sadique";case 3:return"rampant";case 7:return"mutant";default:return"unknown"}}var r=/tabavat\[\d+\]\s=\s(\[.*\]);/gi,o="id,photo,nom,tag,barbe,classe,cote,distance,x,y,description,attaquer,gifler,estCible";return u(n,r,o.split(","),function(n){var r={id:i(n.id),nom:n.nom,image:e.imageUrl(n.photo),description:n.description,position:[i(n.x),i(n.y)],cote:t(i(n.classe)),rang:n.cote,barbe:i(n.barbe)/100},o=c(n.tag);return o&&(r.guilde=o),r})}function l(n){var t=/tabobjet\[\d+\]\s=\s(\[.*\]);/gi,r="id,photo,nom,distance,x,y,categorie,poussiere";return u(n,t,r.split(","),function(n){return{id:i(n.id),nom:n.nom,image:e.imageUrl(n.photo),categorie:n.categorie.toLowerCase(),position:[i(n.x),i(n.y)],poussiere:i(n.poussiere)}})}function f(n){var e=o(n),t=s(n),r=l(n);return{monde:e.monde,position:e.position,nains:t,objets:r}}return n("detect",f,{})}(s,e,i,l),d=function(n,e,t,r){var i=t([r]);return{gameUrl:n.gameUrl,imageUrl:n.imageUrl,isInGame:n.isInGame,getNain:e.get,pages:i}}(e,t,o,f),m=function(n){return n}(d),p=function(){var n=window.console,e=Function.prototype.bind;return n&&n.log&&e?e.call(n.log,n):function(){}}(),v=function(n,e){function t(t){var r=t.infoFrame,i=function(){var t,i=r.contentWindow,o=i.document,a=i.location,u=a.origin+a.pathname,c=n.pages.byUrl(u);e("Navigation to "+u),c&&(e("Analyzing "+c.name),t=c.analyze(o),e(t))},o=!1,a=function(n){var e=o;o=!!n,e!==o&&(o?r.addEventListener("load",i,!1):r.removeEventListener("load",i,!1))};return a(!0),Object.freeze({get enabled(){return o},set enabled(n){a(n)}})}return t}(m,p),g=function(n){var e=document.scripts[document.scripts.length-1],t=e.src,r=t.slice(0,t.lastIndexOf("/")+1),i=n.normalize(r+"../css/nany.min.css"),o=e.getAttribute("data-channel");return{channel:o,scriptUrl:t,cssUrl:i}}(a),b=function(n,e){function t(n){var t=n.container,r=null,i=function(){var t=e.renderer(document),r=t.div("Nany "+n.channel,{className:"VNT title"}),i=t.div("Chargement en cours...",{className:"TV content"});return t.div([r,i],{className:"nany"})}(),o=!1,a=function(n){var e=o;o=!!n,o!==e&&(o?(r=t.innerHTML,t.innerHTML="",t.appendChild(i)):(t.innerHTML=r,r=null))};return a(!0),Object.freeze({get enabled(){return o},set enabled(n){a(n)}})}return t}(g,c),h=function(n,e,t,r){function i(n){return void 0===n||null===n?n:void 0!==n.nodeType?n:window.document.querySelector(n)}function o(o){function a(){c&&(c.enabled=!1),u&&(u.enabled=!1)}var u,c,s={user:t(),channel:"default",container:window.document.body,infoFrame:void 0};return r(s,o),s.container=i(s.container),s.infoFrame=i(s.infoFrame),s.container&&(u=e(s)),s.infoFrame&&(c=n(s)),Object.freeze({user:s.user,channel:s.channel,dashboard:u,spy:c,destroy:a})}return o}(v,b,n,u),y=function(n,e){function t(e,t){var r=["javascript:(function () {","var w = window,","    l = w.location,","    u = l.origin + l.pathname,","    d = document,","    b = d.body,",'    n = "nany",','    i = n + "Script",',"    s = d.getElementById(i);",'if (u === "'+n.gameUrl()+'") {',"    if (s) b.removeChild(s);",'    s = d.createElement("script");',"    s.id = i;",'    s.type = "text/javascript";','    s.src = "'+e+'";',"    s.async = false;",'    s.setAttribute("data-channel", "'+t+'");',"    b.appendChild(s);","} else {",'    alert("Erreur : ce script ne fonctionne que dans la partie jeu de Nainwak !");',"}","}())"];return r.join("\n").replace(/\s+/g," ")}function r(n){var r=document.querySelectorAll(n||".nanylet");Array.prototype.forEach.call(r,function(n){var r=n.getAttribute("data-channel"),i=t(e.scriptUrl,r);n.setAttribute("href",i)})}return{initialize:r}}(m,g),w=function(n,e){function t(n){var e=n||window.document;return e.getElementsByTagName("head")[0]}function r(r,i){var o=e.normalize(r,i),a=t(i).getElementsByTagName("link");return n.find(a,function(n){return n.href===o})}function i(n,e){var t=e||window.document,r=t.createElement("link");return r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",n),r}function o(n,e){var o=r(n,e);if(!o)return o=i(n,e),t(e).appendChild(o),o}return{createLink:i,insertLink:o}}(i,a),j=function(n,e,t,r,i,o){function a(n,e){try{delete n[e]}catch(t){n[e]=void 0}}function u(t){var u="nanyApplication",c=t[u];if(c)return c.destroy(),void a(t,u);var s=t.frames,l=s.pub.document,f=s.info.frameElement,d=r.getNain(t);o.insertLink(i.cssUrl,l),t[u]=e({user:n(d.nom,d.image),channel:i.channel,container:l.body,infoFrame:f})}function c(){r.isInGame(window)&&u(window)}return c(),Object.freeze({initBookmarklets:t.initialize,User:n,Application:e})}(n,h,y,m,g,w),E=function(n){return n}(j),window.nany=E}();
//# sourceMappingURL=nany.min.js.map